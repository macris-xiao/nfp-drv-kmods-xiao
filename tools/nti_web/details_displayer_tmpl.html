<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title><!-- X_TITLE_X --></title>
    <style>
      div {
	  width: max-content;
	  border: 0.2px solid grey;
	  background-color: #acf;
      }
      div:hover {
	  width: max-content;
	  border: 0.2px solid black;
	  color: blue;
	  background-color: white;
      }
      .expanded {
	  width: max-content;
	  background-color: darkgrey;
	  color: black;
      }
    </style>
  </head>
  <body>
      <h2><!-- X_TITLE_X --></h2>
      <!-- X_CONTENT_X -->

  </body>
  <script>
    var arr = [
	    <!-- X_SCRIPT_TBL_X -->
    ];
    var states = []; // 0 - folded; 1 - show children; 2 - expand children
    var expanded = "null";

    for (var i = 0; i < arr.length; i++) {
	states.push(0);
    }

    <!-- X_SCRIPT_LISTENERS_X -->

      function divHider(id) {
	  var div = document.getElementById(id);
	  var divID = parseInt(id.substring(3, id.length));
	  var divStars = arr[divID];

	  if (states[divID] == 0) {
	      div.classList.add("expanded");
	  } else if (states[divID] == 1) {

	  } else if (states[divID] == 2) {
	      div.classList.remove("expanded");
	  }
	  states[divID] = (states[divID] + 1) % 3;

	  // Expand children
	  for (var i = divID + 1; i < arr.length; i++) {
	      if (divStars >= arr[i])
		  break;

	      var laterDiv = document.getElementById("div" + i)

	      if (states[divID] == 0) {
		  laterDiv.style.display = "none";
		  laterDiv.classList.remove("expanded");
		  states[i] = 0;
	      } else if (states[divID] == 1) {
		  if (divStars == arr[i] - 1) {
		      laterDiv.style.display = "block";
		  }
	      } else if (states[divID] == 2) {
		  laterDiv.style.display = "block";
		  laterDiv.classList.add("expanded");
		  states[i] = 2;
	      }
	  }

	  // Notify parents
	  nextParentStars = divStars - 1;
	  if (states[divID] == 1) {
	      for (var i = divID - 1; i >= 0; i--) {
		  if (arr[i] == nextParentStars) {
		      states[i] = 2;
		      nextParentStars--;
		  }
	      }

	      // Skip state 1 if no children with stars
	      if (divID + 2 >= arr.length ||
		  arr[divID + 1] <= arr[divID] ||
		  arr[divID + 2] <= arr[divID]) {
		  states[divID]++;
	      }
	  }
      }
  </script>
</html>
